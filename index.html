<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diagnóstico Diferencial — Ejercicio con orden aleatorio de respuestas</title>
    <style>
        :root{
            --bg:#f5f7fa; --primary:#2c3e50; --accent:#3498db; --danger:#e74c3c;
            --light:#ecf0f1; --success:#27ae60; --radius:8px; --shadow:0 4px 8px rgba(0,0,0,.08);
        }
        *{box-sizing:border-box;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif}
        body{background:var(--bg);color:#222;margin:0;padding:20px}
        .container{max-width:1100px;margin:0 auto}
        header{background:var(--primary);color:#fff;padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);text-align:center}
        h1{margin:0;font-size:1.6rem}
        .instructions, .case-container, .results{background:#fff;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);margin-top:16px}
        .case-tabs{display:flex;gap:8px;margin-top:12px}
        .case-tab{background:#f0f2f5;padding:8px 12px;border-radius:6px;cursor:pointer}
        .case-tab.active{background:#fff;border:1px solid #e1e6ee;font-weight:600}
        .case-description{background:var(--light);padding:12px;border-radius:6px;border-left:4px solid var(--accent);margin-bottom:12px}
        .question{border:1px solid #e6e9ef;padding:12px;border-radius:8px;margin-bottom:12px}
        .options{margin-top:8px;display:flex;flex-direction:column;gap:8px}
        .option{background:#fbfcfd;padding:10px 12px;border-radius:8px;border:1px solid #e7eaef;cursor:pointer;transition:all .18s}
        .option:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.04)}
        .option.selected{background:#e6f7fb;border-color:var(--accent)}
        .option.correct{background:#eafaf0;border-color:var(--success)}
        .option.incorrect{background:#fff0f0;border-color:var(--danger)}
        .feedback{display:none;margin-top:10px;padding:10px;border-radius:6px}
        .feedback.correct{background:#eafaf0;border:1px solid var(--success);color:#145724}
        .feedback.incorrect{background:#fff0f0;border:1px solid var(--danger);color:#6d1b1b}
        .submit-btn{margin-top:8px;padding:10px 14px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer}
        .nav{display:flex;justify-content:space-between;margin-top:14px}
        .nav button{padding:8px 12px;border-radius:8px;border:none;background:var(--primary);color:#fff;cursor:pointer}
        .progress-bar{height:10px;background:#e9ecef;border-radius:6px;overflow:hidden;margin-top:14px}
        .progress{height:100%;background:var(--success);width:0;transition:width .4s}
        footer{margin-top:18px;color:#555;font-size:.9rem}
        @media (max-width:700px){body{padding:12px}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Diagnóstico diferencial — práctica (respuestas en orden aleatorio)</h1>
            <div style="font-size:.95rem;margin-top:6px">Cada vez que abras este archivo, la posición de las opciones se barajará aleatoriamente para cada pregunta.</div>
        </header>

        <section class="instructions">
            <h2>Instrucciones</h2>
            <p>Lee cada caso clínico nuevo (los contenidos son distintos a los anteriores). Para cada caso selecciona: (1) la hipótesis diagnóstica principal; (2) la batería de evaluación prioritaria; (3) el tratamiento psicológico de primera elección. Pulsa "Verificar Respuestas" para recibir retroalimentación inmediata. Las opciones aparecen en un orden aleatorio cada vez que se carga la página.</p>
        </section>

        <div class="case-tabs">
            <div class="case-tab active" data-case="1">Caso 1</div>
            <div class="case-tab" data-case="2">Caso 2</div>
            <div class="case-tab" data-case="3">Caso 3</div>
        </div>

        <!-- Caso 1 -->
        <div id="case-1" class="case-container">
            <h2>Caso 1 — Reticencia Escolar y Habla Normal en Casa</h2>
            <div class="case-description">
                <p>Marcos, 7 años, comenzó el primer grado en una escuela nueva hace 3 meses. Sus docentes lo describen como íntegramente silencioso en la escuela: no responde preguntas, no participa en juegos y se niega a leer en voz alta. En el hogar, sus padres relatan que canta en la ducha, conversa con hermanos y amigos de su barrio con facilidad. En la evaluación clínica, inicialmente se muestra callado en la sala de espera, pero hablando con su madre al lado contesta con frases complejas. No refiere intereses inusuales ni conductas repetitivas rígidas.</p>
            </div>

            <div class="question" data-q="1">
                <h3>1. Hipótesis diagnóstica principal</h3>
                <div class="options">
                    <div class="option" data-value="a">Trastorno del Espectro Autista (TEA), por la presentación de inhibición social.</div>
                    <div class="option" data-value="b">Mutismo Selectivo, por la inhibición situacional del habla (solo en la escuela) con habla normal en contextos familiares.</div>
                    <div class="option" data-value="c">Trastorno de la Comunicación Social (Pragmático), por posible dificultad en el uso del lenguaje en contextos escolares.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="2">
                <h3>2. Evaluación prioritaria</h3>
                <div class="options">
                    <div class="option" data-value="a">Observación en el aula, entrevista con padres y profesores, y escalas de mutismo/ansiedad para contexto escolar.</div>
                    <div class="option" data-value="b">ADI-R y ADOS-2 para descartar TEA, junto con historia del desarrollo exhaustiva.</div>
                    <div class="option" data-value="c">Evaluación formal de pragmática del lenguaje (CELF u otra) sin enfocarse en ansiedad.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="3">
                <h3>3. Tratamiento de primera elección</h3>
                <div class="options">
                    <div class="option" data-value="a">Intervenciones estructuradas para TEA (por ejemplo TEACCH), combinadas con entrenamiento parental.</div>
                    <div class="option" data-value="b">Programa conductual de exposición gradual en el contexto escolar (con refuerzo positivo y colaboración docente) dirigido a mutismo selectivo.</div>
                    <div class="option" data-value="c">Terapia de grupo para habilidades pragmáticas del lenguaje.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <button class="submit-btn" onclick="checkAnswers(1)">Verificar Respuestas</button>

            <div class="results" id="results-1" style="display:none;margin-top:12px">
                <h3>Retroalimentación Caso 1</h3>
                <p class="case-score" id="score-1"></p>
                <div id="detailed-feedback-1"></div>
            </div>
        </div>

        <!-- Caso 2 -->
        <div id="case-2" class="case-container" style="display:none">
            <h2>Caso 2 — Deterioro Escolar y Episodios Emocionales</h2>
            <div class="case-description">
                <p>Valeria, 9 años, ha mostrado un descenso académico marcado en los últimos 8 meses. Antes era ordenada y aplicada; ahora olvida trabajos, se distrae con facilidad y presenta quejas somáticas matutinas (náuseas y dolor abdominal) antes de ir al colegio. Los padres refieren episodios puntuales de encopresis hace unos meses; el pediatra no encontró causa orgánica. Valeria dice que "tiene miedo de que se rían de mí" y refiere pensamientos recurrentes sobre el olor corporal. No hay historia de problemas atencionales desde edades tempranas.</p>
            </div>

            <div class="question" data-q="1">
                <h3>1. Hipótesis diagnóstica principal</h3>
                <div class="options">
                    <div class="option" data-value="a">Trastorno por déficit de atención (TDAH) de inicio reciente.</div>
                    <div class="option" data-value="b">Encopresis no retentiva como diagnóstico primario que explica los problemas escolares.</div>
                    <div class="option" data-value="c">Trastorno de ansiedad (con componente somático) que produce evitación escolar y encopresis secundaria.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="2">
                <h3>2. Evaluación prioritaria</h3>
                <div class="options">
                    <div class="option" data-value="a">Entrevista estructurada para ansiedad infantil y escalas de ansiedad (por ejemplo SCARED), además de registro de síntomas somáticos y evaluación funcional.</div>
                    <div class="option" data-value="b">Batería para TDAH (Conners, reportes escolares) como primera línea.</div>
                    <div class="option" data-value="c">Diario de evacuaciones y pruebas médicas adicionales para descartar componente orgánico de encopresis.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="3">
                <h3>3. Intervención de primera elección</h3>
                <div class="options">
                    <div class="option" data-value="a">Terapia Cognitivo-Conductual focalizada en ansiedad y exposición a situaciones temidas, con trabajo psicoeducativo sobre encopresis según necesidad.</div>
                    <div class="option" data-value="b">Inicio inmediato de psicoestimulantes para mejorar la atención escolar.</div>
                    <div class="option" data-value="c">Programa intensivo de toilet training sin intervención psicológica adicional.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <button class="submit-btn" onclick="checkAnswers(2)">Verificar Respuestas</button>

            <div class="results" id="results-2" style="display:none;margin-top:12px">
                <h3>Retroalimentación Caso 2</h3>
                <p class="case-score" id="score-2"></p>
                <div id="detailed-feedback-2"></div>
            </div>
        </div>

        <!-- Caso 3 -->
        <div id="case-3" class="case-container" style="display:none">
            <h2>Caso 3 — Identidad Comunicativa y Articulación</h2>
            <div class="case-description">
                <p>Sergio, 8 años, ha recibido terapia del habla por dificultades de articulación desde los 4 años. Su inteligibilidad es limitada en contextos ruidosos, y ha sufrido burlas aisladas de pares. En la escuela evita leer en voz alta por vergüenza, pero en casa se muestra espontáneo, comparte sus descubrimientos y busca la mirada de su madre para mostrar algo que le gusta. No presenta rutinas rígidas ni intereses restringidos de tipo autista.</p>
            </div>

            <div class="question" data-q="1">
                <h3>1. Hipótesis diagnóstica principal</h3>
                <div class="options">
                    <div class="option" data-value="a">Trastorno Fonológico (trastorno de articulación) como problema central que ha generado evitación social secundaria.</div>
                    <div class="option" data-value="b">Trastorno de Ansiedad Social primario que explica la evitación y la disminución de participación escolar.</div>
                    <div class="option" data-value="c">Trastorno del Espectro Autista (TEA) por la evitación comunicativa observada en la escuela.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="2">
                <h3>2. Evaluación prioritaria</h3>
                <div class="options">
                    <div class="option" data-value="a">Evaluación fonoaudiológica completa para delinear el patrón articulatorio y la severidad de la inteligibilidad.</div>
                    <div class="option" data-value="b">Batería de ansiedad social y entrevistas clínicas (SPAI-C u otro) como primera prioridad.</div>
                    <div class="option" data-value="c">ADI-R y ADOS-2 para descartar TEA.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <div class="question" data-q="3">
                <h3>3. Plan de tratamiento psicológico/terapéutico</h3>
                <div class="options">
                    <div class="option" data-value="a">Terapia del habla intensiva (enfoque fonológico/ articulatorio) con trabajo de generalización a la escuela y apoyo psicoeducativo.</div>
                    <div class="option" data-value="b">Terapia cognitivo-conductual grupal para fobia social (exposición y habilidades sociales) como primera línea.</div>
                    <div class="option" data-value="c">Intervención basada en modelos de desarrollo/ABA por sospecha de TEA.</div>
                </div>
                <div class="feedback"></div>
            </div>

            <button class="submit-btn" onclick="checkAnswers(3)">Verificar Respuestas</button>

            <div class="results" id="results-3" style="display:none;margin-top:12px">
                <h3>Retroalimentación Caso 3</h3>
                <p class="case-score" id="score-3"></p>
                <div id="detailed-feedback-3"></div>
            </div>
        </div>

        <div class="nav">
            <button id="prev" onclick="navigate(-1)" disabled>Anterior</button>
            <button id="next" onclick="navigate(1)">Siguiente</button>
        </div>

        <div class="progress-bar">
            <div class="progress" id="prog"></div>
        </div>

        <footer>
            Ejercicio diseñado para práctica académica — las respuestas y la retroalimentación se generan en el navegador.
        </footer>
    </div>

    <script>
        // ---------- Datos de respuestas correctas y retroalimentación ----------
        // Nota: las opciones serán reordenadas aleatoriamente en DOM al cargar la página.
        // Las respuestas correctas se refieren a data-value ('a','b','c') de cada opción,
        // independientemente de su posición.
        const correctAnswers = {
            1: ['b','a','b'], // Caso1: mutismo selectivo; evaluación: observación/SMQ; tratamiento: exposición gradual
            2: ['c','a','a'], // Caso2: ansiedad; evaluación: entrevista/escala ansiedad; tratamiento: TCC
            3: ['a','a','a']  // Caso3: trastorno fonológico; evaluación: fonoaudiológica; tratamiento: terapia del habla
        };

        const feedback = {
            1: {
                q1: {
                    correct: "Correcto. El patrón de hablar en contextos familiares y el silencio situacional en la escuela es característico de Mutismo Selectivo.",
                    incorrect_a: "Incorrecto. El TEA requeriría déficits persistentes en interacción social y patrones repetitivos que no se observan aquí.",
                    incorrect_c: "Incorrecto. El trastorno pragmático implicaría dificultades de uso del lenguaje en múltiples contextos, no un mutismo situacional con buena comunicación en casa."
                },
                q2: {
                    correct: "Correcto. La observación en aula y entrevistas con padres/profesores, más escalas orientadas a mutismo y ansiedad, son prioritarias para caracterizar el problema.",
                    incorrect_a: "Incorrecto. ADI-R/ADOS-2 son necesarios si se sospecha TEA, pero la prioridad inicial es evaluar la ansiedad situacional y la conducta en el aula.",
                    incorrect_c: "Incorrecto. Evaluar pragmática puede ser útil, pero no sustituye una evaluación dirigida a la ansiedad contextual en este caso."
                },
                q3: {
                    correct: "Correcto. Programas conductuales con exposición gradual y trabajo coordinado con la escuela han mostrado eficacia en mutismo selectivo.",
                    incorrect_a: "Incorrecto. Intervenciones para TEA no son la primera elección cuando los síntomas son situacionales y consisten principalmente en mutismo por ansiedad.",
                    incorrect_c: "Incorrecto. La terapia pragmática no aborda la ansiedad situacional que mantiene el mutismo."
                }
            },
            2: {
                q1: {
                    correct: "Correcto. El conjunto de síntomas (inicio reciente, quejas somáticas, miedo a la burla) es coherente con un trastorno de ansiedad que genera evitación escolar y encopresis secundaria.",
                    incorrect_a: "Incorrecto. El TDAH suele iniciarse en edades más tempranas y presenta un patrón estable, no un cambio agudo asociado a temor social.",
                    incorrect_b: "Incorrecto. La encopresis puede ser secundario a ansiedad pero no suele explicar el inicio agudo del deterioro académico por sí sola."
                },
                q2: {
                    correct: "Correcto. Entrevistas estructuradas y escalas de ansiedad son esenciales para identificar el trastorno de ansiedad y su gravedad.",
                    incorrect_a: "Incorrecto. Las pruebas de TDAH son útiles si hay dudas, pero aquí la presentación sugiere priorizar la evaluación de ansiedad.",
                    incorrect_c: "Incorrecto. Las pruebas médicas son pertinentes si hubiera sospecha orgánica; ya se descartó en la historia clínica según el caso."
                },
                q3: {
                    correct: "Correcto. La TCC para ansiedad infantil, con trabajo de exposición y manejo de síntomas somáticos, es la intervención de primera línea.",
                    incorrect_a: "Incorrecto. Los psicoestimulantes no están indicados para la ansiedad y podrían incluso aumentar la ansiedad y somatizaciones.",
                    incorrect_c: "Incorrecto. El toilet training puede ayudar con encopresis, pero sin abordar la ansiedad subyacente no resolverá el problema central."
                }
            },
            3: {
                q1: {
                    correct: "Correcto. La limitación en inteligibilidad y la conservación de interacción social en casa señalan un trastorno fonológico como problema primario.",
                    incorrect_a: "Incorrecto. La ansiedad social puede ser una consecuencia, pero el núcleo del problema es la articulación.",
                    incorrect_b: "Incorrecto. No hay suficiente evidencia para TEA: no se describen déficits en compartir disfrute, intereses restringidos ni rigidez."
                },
                q2: {
                    correct: "Correcto. La evaluación fonoaudiológica completa es la herramienta clave para identificar el perfil fonológico y planificar la intervención.",
                    incorrect_a: "Incorrecto. Las escalas de ansiedad son útiles para comorbilidad, pero no reemplazan la evaluación del habla cuando la inteligibilidad es el problema central.",
                    incorrect_c: "Incorrecto. Los instrumentos diagnósticos de TEA no son la primera línea sin signos claros que apunten al espectro."
                },
                q3: {
                    correct: "Correcto. Terapia del habla intensiva con trabajo en generalización al entorno escolar es la intervención más apropiada.",
                    incorrect_a: "Incorrecto. La TCC grupal puede ayudar si existe ansiedad secundaria, pero la prioridad clínica es abordar la articulación.",
                    incorrect_c: "Incorrecto. Las intervenciones para TEA no encajan si no hay criterios claros para ese diagnóstico."
                }
            }
        };

        // ---------- Utilidades ----------
        function shuffleArray(arr){
            for(let i = arr.length -1; i > 0; i--){
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Reordena (baraja) las opciones DOM de cada pregunta para que la posición de la respuesta correcta cambie
        function shuffleOptionsOnLoad(){
            document.querySelectorAll('.question').forEach(q => {
                const container = q.querySelector('.options');
                const opts = Array.from(container.querySelectorAll('.option'));
                // Detach and shuffle
                const shuffled = shuffleArray(opts.slice());
                // Remove existing
                container.innerHTML = '';
                // Append in shuffled order
                shuffled.forEach(opt => container.appendChild(opt));
            });
        }

        // Asignar manejadores de selección a opciones (se ejecuta después de barajar)
        function bindOptionHandlers(){
            document.querySelectorAll('.option').forEach(opt => {
                opt.addEventListener('click', function(){
                    const parentQ = this.closest('.question');
                    parentQ.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');

                    // Guardar respuesta en estructura userAnswers
                    const caseNum = parseInt(this.closest('.case-container').id.split('-')[1]);
                    const questions = Array.from(this.closest('.case-container').querySelectorAll('.question'));
                    const idx = questions.indexOf(parentQ); // 0-based
                    const key = 'q' + (idx + 1);
                    userAnswers[caseNum][key] = this.getAttribute('data-value');
                });
            });
        }

        // ---------- Estado del usuario ----------
        let userAnswers = {
            1:{q1:null,q2:null,q3:null},
            2:{q1:null,q2:null,q3:null},
            3:{q1:null,q2:null,q3:null}
        };
        let completed = {1:false,2:false,3:false};
        let current = 1;

        // ---------- Navegación de casos ----------
        function showCase(n){
            document.querySelectorAll('.case-container').forEach(el => el.style.display = 'none');
            document.getElementById('case-' + n).style.display = 'block';
            document.querySelectorAll('.case-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.case-tab[data-case="' + n + '"]').classList.add('active');
            document.getElementById('prev').disabled = n === 1;
            document.getElementById('next').disabled = n === 3;
            current = n;
            updateProgress();
        }

        function navigate(dir){
            const target = current + dir;
            if(target >=1 && target <=3) showCase(target);
        }

        // ---------- Verificación y retroalimentación ----------
        function checkAnswers(caseNum){
            const caseEl = document.getElementById('case-' + caseNum);
            const questions = Array.from(caseEl.querySelectorAll('.question'));
            let score = 0;

            questions.forEach((question, idx) => {
                const qKey = 'q' + (idx + 1);
                const user = userAnswers[caseNum][qKey];
                const correct = correctAnswers[caseNum][idx];
                const opts = Array.from(question.querySelectorAll('.option'));
                const fb = question.querySelector('.feedback');

                // limpiar estilos previos
                opts.forEach(o => o.classList.remove('correct','incorrect'));
                fb.classList.remove('correct','incorrect');
                fb.style.display = 'none';
                fb.textContent = '';

                if(user){
                    // marcar opciones correctas/incorrectas
                    opts.forEach(o => {
                        if(o.getAttribute('data-value') === correct) o.classList.add('correct');
                        if(o.getAttribute('data-value') === user && user !== correct) o.classList.add('incorrect');
                    });

                    if(user === correct){
                        score++;
                        fb.textContent = feedback[caseNum][qKey].correct;
                        fb.classList.add('correct');
                    } else {
                        const key = 'incorrect_' + user;
                        const msg = feedback[caseNum][qKey][key] || 'Respuesta incorrecta. Revisa la retroalimentación general.';
                        fb.textContent = msg;
                        fb.classList.add('incorrect');
                    }
                    fb.style.display = 'block';
                } else {
                    fb.textContent = 'Por favor selecciona una respuesta antes de verificar.';
                    fb.classList.add('incorrect');
                    fb.style.display = 'block';
                }
            });

            // Mostrar resultados resumidos
            const resEl = document.getElementById('results-' + caseNum);
            const scoreEl = document.getElementById('score-' + caseNum);
            const detEl = document.getElementById('detailed-feedback-' + caseNum);
            scoreEl.textContent = `Puntuación: ${score}/3 (${Math.round(score/3*100)}%)`;
            let summary = '<ul>';
            if(score === 3) summary += '<li>Excelente: identificaste correctamente diagnóstico, evaluación y tratamiento.</li>';
            else if(score === 2) summary += '<li>Buen trabajo: revisa la pregunta incorrecta y su retroalimentación.</li>';
            else if(score === 1) summary += '<li>Es recomendable repasar criterios diagnósticos y herramientas de evaluación.</li>';
            else summary += '<li>Revisa los conceptos claves y vuelve a intentar.</li>';
            summary += '</ul>';
            detEl.innerHTML = summary;
            resEl.style.display = 'block';

            completed[caseNum] = true;
            updateProgress();
        }

        function updateProgress(){
            const done = Object.values(completed).filter(Boolean).length;
            const pct = Math.round((done / 3) * 100);
            document.getElementById('prog').style.width = pct + '%';
        }

        // ---------- Inicialización: barajar opciones y preparar interfaz ----------
        document.addEventListener('DOMContentLoaded', () => {
            // 1) Barajar posiciones de las opciones para cada pregunta
            shuffleOptionsOnLoad();

            // 2) Volver a enlazar manejadores a opciones (después de barajar)
            bindOptionHandlers();

            // 3) Enlazar pestañas de casos
            document.querySelectorAll('.case-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const n = parseInt(tab.getAttribute('data-case'), 10);
                    showCase(n);
                });
            });

            // 4) Inicializar casos ocultos y progreso
            showCase(1);
        });

        // Hacer la función checkAnswers global para botones inline
        window.checkAnswers = checkAnswers;
        window.navigate = navigate;
    </script>
</body>
</html>
